.686
.model flat
public _miesz2float

.code
_miesz2float PROC ; float _miesz2float(int miesz32)
	push ebp
	mov ebp, esp

	mov eax, [ebp + 8] ; liczba mieszana

;szukanie najstarszej jedynki
	mov ecx, 31
ptl:
	bt eax, ecx
	jc dalej1
	loop ptl
dalej1: ; w ecx znajduje siê pozycja najstarszej jedynki
	cmp ecx, 23
	ja wiecej
	jb mniej
	mov ecx, 0
	jmp dalej2

wiecej:
	sub ecx, 23
	shr eax, cl
	add ecx, 15 ; 23-8
	jmp dalej2

mniej:
	sub ecx, 23
	neg ecx
	shl eax, cl
	neg ecx
	add ecx, 15 ; 23-8
	jmp dalej2

dalej2: ; w ecx - wyk³adnik, w eax mantysa z jedynk¹
	add ecx, 127
	shl ecx, 23 ; wyk³adnik na swoim miejscu
	btr eax, 23
	add eax, ecx

	finit
	push eax
	fld dword ptr [esp]
	pop eax

	pop ebp
	ret
_miesz2float ENDP

END